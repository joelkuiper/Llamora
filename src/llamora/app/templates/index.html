{% extends 'layouts/base.html' %}

{% block header %}
  <div id="branding">
    <a class="branding-link"
       href="{{ url_for('days.day_today') }}"
       aria-label="Return to today"
       data-tooltip-title="Return to today"
       data-tooltip-offset-y="0"
       hx-get="{{ url_for('entries.entries_htmx_today') }}"
       hx-target="#content-wrapper"
       hx-swap="outerHTML"
       hx-push-url="true"
       data-logo-toggle>
      <img class="logo"
           src="{{ url_for('static', filename='img/logo.svg') }}"
           alt="{{ config.APP_NAME }} logo"
           data-light-default="{{ url_for('static', filename='img/logo.svg') }}"
           data-light-hover="{{ url_for('static', filename='img/logo-hover.svg') }}"
           data-light-active="{{ url_for('static', filename='img/logo-hover.svg') }}"
           data-dark-default="{{ url_for('static', filename='img/logo-dark.svg') }}"
           data-dark-hover="{{ url_for('static', filename='img/logo-dark-hover.svg') }}"
           data-dark-active="{{ url_for('static', filename='img/logo-dark-hover.svg') }}">
    </a>
  </div>

  <calendar-control id="calendar-control">
    <button id="prev-day" type="button" class="icon-btn" aria-label="Previous day" data-tooltip-title="Previous day">
      <span class="icon-mask icon-chevron-left" aria-hidden="true"></span>
    </button>
    <button id="calendar-btn" type="button" class="icon-btn" aria-label="Calendar"
            aria-haspopup="dialog" aria-expanded="false" aria-controls="calendar-popover"
            data-tooltip-title="Change day">
      <span class="icon-mask icon-calendar-days" aria-hidden="true"></span>
      <span id="calendar-label">{{ day|long_date }}</span>
    </button>
    <button id="next-day"
            type="button"
            class="icon-btn"
            aria-label="Next day"
            {% if is_today %}disabled aria-disabled="true"{% endif %}
            {% if not is_today %}data-tooltip-title="Next day"{% endif %}>
      <span class="icon-mask icon-chevron-right" aria-hidden="true"></span>
    </button>
    <div id="calendar-popover"
         class="calendar-popover"
         role="tooltip"
         hidden
         data-calendar-url="{{ url_for('days.calendar_view') }}"></div>
  </calendar-control>

  <div class="header-right">
    <div class="search-wrap">
      <search-overlay>
        {% include 'partials/search_form.html' %}
        <section id="search-results">
          {% include 'partials/search_results.html' %}
        </section>
      </search-overlay>
    </div>
    <div class="user-actions">
      <a id="profile-btn"
         href="{{ url_for('auth.profile') }}"
         hx-get="{{ url_for('auth.profile') }}"
         hx-target="#profile-modal-root"
         hx-swap="innerHTML"
         class="icon-btn"
         aria-label="Profile" data-tooltip-title="Profile">
        <span class="icon-mask icon-user-round" aria-hidden="true"></span>
      </a>
      <form method="post" action="{{ url_for('auth.logout') }}">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        <button type="submit" class="icon-btn" aria-label="Logout" data-tooltip-title="Logout">
          <span class="icon-mask icon-log-out" aria-hidden="true"></span>
        </button>
      </form>
    </div>
  </div>
{% endblock %}

{% block content %}
  <div id="content">
    <div id="entries-loading" class="entries-loading" hidden aria-hidden="true">
      <div class="entries-loading__backdrop" aria-hidden="true"></div>
      <div class="entries-loading__panel" role="status" aria-live="polite">
        <span class="entries-loading__spinner spinner" aria-hidden="true"></span>
        <span class="entries-loading__label">Retrievingâ€¦</span>
      </div>
    </div>
    {% if entries_html is defined %}
      {{ entries_html|safe }}
    {% else %}
      {% set tpl = content_template if content_template is defined else 'partials/entries.html' %}
      {% include tpl %}
    {% endif %}
  </div>
{% endblock %}
