{% extends 'layouts/base.html' %}

{% block header %}
  <div id="branding">
    <a class="branding-link"
       href="{{ url_for('days.day_today') }}"
       aria-label="Return to today"
       data-tooltip-title="Return to today"
       data-tooltip-offset-y="0"
       hx-get="{{ url_for('chat.chat_htmx_today') }}"
       hx-target="#content-wrapper"
       hx-swap="outerHTML"
       hx-push-url="true"
       data-logo-toggle>
      <img class="logo"
           src="{{ url_for('static', filename='img/logo.svg') }}"
           alt="{{ config.APP_NAME }} logo"
           data-light-default="{{ url_for('static', filename='img/logo.svg') }}"
           data-light-hover="{{ url_for('static', filename='img/logo-hover.svg') }}"
           data-light-active="{{ url_for('static', filename='img/logo-hover.svg') }}"
           data-dark-default="{{ url_for('static', filename='img/logo-dark.svg') }}"
           data-dark-hover="{{ url_for('static', filename='img/logo-dark-hover.svg') }}"
           data-dark-active="{{ url_for('static', filename='img/logo-dark-hover.svg') }}">
    </a>
  </div>

  <calendar-control id="calendar-control">
    <button id="prev-day" type="button" class="icon-btn" aria-label="Previous day" data-tooltip-title="Previous day">
      <img src="{{ url_for('static', filename='icons/chevron-left.svg') }}"
           alt=""
           aria-hidden="true">
    </button>
    <button id="calendar-btn" type="button" class="icon-btn" aria-label="Calendar"
            aria-haspopup="dialog" aria-expanded="false" aria-controls="calendar-popover"
            data-tooltip-title="Change day">
      <img src="{{ url_for('static', filename='icons/calendar-days.svg') }}"
           alt=""
           aria-hidden="true">
      <span id="calendar-label">{{ day|long_date }}</span>
    </button>
    <button id="next-day"
            type="button"
            class="icon-btn"
            aria-label="Next day"
            {% if is_today %}disabled aria-disabled="true"{% endif %}
            {% if not is_today %}data-tooltip-title="Next day"{% endif %}>
      <img src="{{ url_for('static', filename='icons/chevron-right.svg') }}"
           alt=""
           aria-hidden="true">
    </button>
    <div id="calendar-popover"
         class="calendar-popover"
         role="tooltip"
         hidden
         data-calendar-url="{{ url_for('days.calendar_view') }}"></div>
  </calendar-control>

  <div class="header-right">
    <div class="search-wrap">
      <search-overlay>
        {% include 'partials/search_form.html' %}
        <section id="search-results">
          {% include 'partials/search_results.html' %}
        </section>
      </search-overlay>
    </div>
    <div class="user-actions">
      <a id="profile-btn"
         href="{{ url_for('auth.profile') }}"
         hx-get="{{ url_for('auth.profile') }}"
         hx-target="#content-wrapper"
         hx-swap="outerHTML"
         hx-push-url="true"
         class="icon-btn"
         aria-label="Profile" data-tooltip-title="Profile">
        <img src="{{ url_for('static', filename='icons/user-round.svg') }}"
             alt=""
             aria-hidden="true">
      </a>
      <form method="post" action="{{ url_for('auth.logout') }}">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        <button type="submit" class="icon-btn" aria-label="Logout" data-tooltip-title="Logout">
          <img src="{{ url_for('static', filename='icons/log-out.svg') }}"
               alt=""
               aria-hidden="true">
        </button>
      </form>
    </div>
  </div>
{% endblock %}

{% block content %}
  <div id="content">
    {% if chat_html is defined %}
      {{ chat_html|safe }}
    {% else %}
      {% set tpl = content_template if content_template is defined else 'partials/chat.html' %}
      {% include tpl %}
    {% endif %}
  </div>
{% endblock %}
