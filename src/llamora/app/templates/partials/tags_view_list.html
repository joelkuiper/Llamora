{% set active_tag = selected_tag if selected_tag is defined else (tags_view.selected_tag if tags_view is defined and tags_view else None) %}
{% set sort_kind = tags_sort_kind if tags_sort_kind is defined else (tags_view.sort_kind if tags_view is defined and tags_view else 'count') %}
{% set sort_dir = tags_sort_dir if tags_sort_dir is defined else (tags_view.sort_dir if tags_view is defined and tags_view else 'desc') %}
{% set tag_items = tags_view.tags if tags_view is defined and tags_view else [] %}
{% if tag_items %}
  <nav class="tags-view__index" aria-label="Trace index" data-tags-view-index>
    {% for item in tag_items %}
      {% set tag_url = url_for('days.day', date=day) ~ '?view=tags&sort_kind=' ~ sort_kind ~ '&sort_dir=' ~ sort_dir ~ '&tag=' ~ (item.name|urlencode) %}
      <a class="tags-view__index-row{% if item.name == active_tag %} is-active{% endif %}"
         id="tag-index-{{ item.name }}"
         href="{{ tag_url }}"
         data-tag-name="{{ item.name }}"
         data-tags-name="{{ item.name }}"
         data-tags-count="{{ item.count }}"
         {% if item.name == active_tag %}aria-current="true"{% endif %}
         hx-get="{{ url_for('tags.tags_view_fragment', date=day) }}?sort_kind={{ sort_kind }}&sort_dir={{ sort_dir }}&tag={{ item.name|urlencode }}"
         hx-target="#tags-view-detail"
         hx-swap="outerHTML"
         hx-push-url="{{ tag_url }}">
        <span class="tags-view__index-name">{{ item.name }}</span>
        <span class="tags-view__index-count">{{ item.count }}</span>
      </a>
    {% endfor %}
  </nav>
  <p class="tags-view__search-empty" data-tags-view-empty hidden>No matching traces.</p>
{% else %}
  <p class="tags-view__empty-index">No traces yet.</p>
{% endif %}
