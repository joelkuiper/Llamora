{% macro ask_llm_button(user_msg_id, day, reply_kinds=()) -%}
<details class="ask-llm-menu">
  <summary class="ask-llm"
           aria-label="Ask {{ config.APP_NAME }}"
           title="Ask {{ config.APP_NAME }}">
    <span class="visually-hidden">Ask {{ config.APP_NAME }}</span>
    <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
      <path d="M5 16.5V6.75c0-.97.78-1.75 1.75-1.75h10.5c.97 0 1.75.78 1.75 1.75v7.5c0 .97-.78 1.75-1.75 1.75H9.5l-3.5 2.5z"
            fill="none"
            stroke="currentColor"
            stroke-linejoin="round"
            stroke-linecap="round"
            stroke-width="1.5" />
      <path d="M11.25 9.6c0-.97.78-1.75 1.75-1.75s1.75.78 1.75 1.75c0 .77-.46 1.36-1.14 1.62-.46.17-.86.57-.86 1.06v.47"
            fill="none"
            stroke="currentColor"
            stroke-linecap="round"
            stroke-width="1.5" />
      <circle cx="13" cy="14.9" r="0.7" fill="currentColor" />
    </svg>
  </summary>
  <div class="ask-llm-menu__panel" role="menu">
    {% for kind in reply_kinds %}
    <button class="ask-llm-menu__item"
            type="button"
            role="menuitem"
            hx-post="{{ url_for('chat.ask_llm', date=day, user_msg_id=user_msg_id) }}"
            hx-target="closest .message"
            hx-swap="afterend"
            hx-include="#user-time"
            hx-vals='{"reply_kind":"{{ kind.id }}"}'
            hx-on::config-request="const t=document.getElementById('user-time'); if(t){t.value=new Date().toISOString();}"
            hx-on::after-request="const menu=this.closest('details'); if(menu){menu.removeAttribute('open');}">
      <span class="ask-llm-menu__label">{{ kind.label }}</span>
    </button>
    {% endfor %}
  </div>
</details>
{%- endmacro %}
