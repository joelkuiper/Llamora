{% macro ask_llm_button(user_msg_id, day, reply_kinds=()) -%}
<details class="ask-llm-menu">
  <summary class="ask-llm message-action"
           aria-label="Ask {{ config.APP_NAME }}"
           data-tooltip-title="Ask {{ config.APP_NAME }}">
    <span class="visually-hidden">Ask {{ config.APP_NAME }}</span>
    <span class="icon-mask icon-reply message-action__icon" aria-hidden="true"></span>
  </summary>
  <div class="ask-llm-menu__panel" role="menu">
    {% for kind in reply_kinds %}
    <button class="ask-llm-menu__item"
            type="button"
            role="menuitem"
            hx-post="{{ url_for('chat.ask_llm', date=day, user_msg_id=user_msg_id) }}"
            hx-target="#msg-{{ user_msg_id }}"
            hx-swap="afterend"
            hx-include="#user-time"
            hx-vals='{"reply_kind":"{{ kind.id }}"}'
            hx-on::config-request="const t=document.getElementById('user-time'); if(t){t.value=new Date().toISOString();}"
            hx-on::after-request="const menu=this.closest('details'); if(menu){menu.removeAttribute('open');}">
      <span class="ask-llm-menu__label">{{ kind.label }}</span>
    </button>
    {% endfor %}
  </div>
</details>
{%- endmacro %}
