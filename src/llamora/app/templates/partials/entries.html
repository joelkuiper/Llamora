<script>
  (() => {
    try {
      const key = "opening_collapsed_{{ day }}";
      document.documentElement.classList.add("opening-syncing");
      if (localStorage.getItem(key) === "1") {
        document.documentElement.dataset.openingCollapsed = "1";
      } else {
        delete document.documentElement.dataset.openingCollapsed;
      }
      requestAnimationFrame(() => {
        document.documentElement.classList.remove("opening-syncing");
      });
    } catch (error) {
      delete document.documentElement.dataset.openingCollapsed;
      document.documentElement.classList.remove("opening-syncing");
    }
  })();
</script>
<main
  id="content-wrapper"
  {% if oob %} hx-swap-oob="true" {% endif %}>
  <entry-view{% if request.headers.get('HX-Request') == 'true' %} data-rendering="true"{% endif %}{% if scroll_target %} data-scroll-target="{{ scroll_target }}"{% endif %}
             data-view-kind="{{ view_kind }}"
             aria-busy="{{ 'true' if request.headers.get('HX-Request') == 'true' else 'false' }}">
    {% include 'partials/entries_history.html' %}
    {% if is_today %}
    <entry-form data-date="{{ day }}">
      <form id="entry-form"
            hx-post="{{ url_for('entries.send_entry', date=day) }}"
            hx-target="#entries"
            hx-on::after-request="this.reset()"
            hx-swap="beforeend">
        <div class="input-wrapper">
          <label class="visually-hidden" for="entry-text">Entry for {{ day|long_date }}</label>
          <textarea class="input"
                    id="entry-text"
                    name="text"
                    rows="3"
                    placeholder="{{ 'Write your thoughts hereâ€¦' if is_today else 'This day has passed.' }}"
                    cols="40"
                    maxlength="{{ config.MAX_MESSAGE_LENGTH }}"></textarea>
          <input type="hidden" name="user_time" id="user-time" />
          <div class="entry-submit-stack">
            <button id="send-btn" class="btn" type="submit" aria-label="Send"{% if not is_today %} disabled{% endif %}>
              <span class="icon-mask icon-feather send-icon" aria-hidden="true"></span>
            </button>
            <span class="entry-char-counter"
                  data-char-counter
                  data-char-counter-for="entry-text"
                  data-char-threshold="40"
                  aria-live="polite"
                  aria-atomic="true">{{ config.MAX_MESSAGE_LENGTH }} left</span>
          </div>
        </div>
      </form>
    </entry-form>

    {% else %}
    <div class="return-today" role="group" aria-label="Archived day divider">
      <div class="return-today__divider" aria-hidden="true">
        <span class="return-today__line return-today__line--left"></span>
        <span class="return-today__date">{{ day|long_date }}</span>
        <span class="return-today__line return-today__line--right"></span>
      </div>
      <p class="return-today__copy">This moment has settled into memory.</p>
      <a
        class="return-today__action"
        href="{{ url_for('days.day_today') }}"
        hx-get="{{ url_for('entries.entries_htmx_today') }}"
        hx-target="#content-wrapper"
        hx-swap="outerHTML"
        hx-push-url="true">
        Return to the present
      </a>
    </div>
    {% endif %}

    <scroll-bottom-button></scroll-bottom-button>
  </entry-view>
</main>
