{% set entry_count = tag.count or 0 %}
{% set last_used = tag.last_used %}
{% set tag_hash = tag.hash %}
{% set has_more = has_more|default(false) %}
{% set next_cursor = next_cursor|default(None) %}
{% set page_size = page_size|default(12) %}
{% set detail_day = detail_day|default(None) %}
{% if detail_day %}
  {% set trace_url = url_for('days.day', date=detail_day) ~ '?view=tags&entries_limit=12&tag=' ~ (tag.name|urlencode) ~ '&target=' ~ (('tag-index-' ~ tag.name)|urlencode) %}
{% else %}
  {% set trace_url = None %}
{% endif %}
<div class="tag-detail" data-tag-hash="{{ tag.hash }}">
  <div class="tag-detail__header">
    <div class="tag-detail__header-row">
      <div class="tag-detail__title">{{ tag.name }}</div>
      <div class="tag-detail__actions">
        {% if trace_url %}
          <a
            class="tag-detail__action tag-detail__goto"
            href="{{ trace_url }}"
            data-tooltip-title="Go to trace"
            aria-label="Go to trace {{ tag.name }}"
            hx-get="{{ trace_url }}"
            hx-target="#main-content"
            hx-swap="outerHTML"
            hx-push-url="true">
            <span class="icon-mask icon-tag" aria-hidden="true"></span>
          </a>
        {% endif %}
        {% if entry_id %}
          <button
            class="tag-detail__action tag-detail__remove"
            type="button"
            data-tooltip-title="Remove trace"
            aria-label="Remove trace {{ tag.name }}"
            hx-delete="{{ url_for('tags.remove_tag', entry_id=entry_id, tag_hash=tag_hash) }}{{ context_query|default('') }}"
            hx-target="entry-tags[data-entry-id='{{ entry_id }}'] .entry-tag[data-tag-hash='{{ tag_hash }}']"
            hx-swap="outerHTML swap:0.15s">
            <span class="icon-mask icon-bookmark-x" aria-hidden="true"></span>
          </button>
        {% endif %}
      </div>
    </div>
    <div class="tag-detail__meta">
      {{ entry_count }} {{ "entry" if entry_count == 1 else "entries" }}
      Â· last used
      <span class="tag-detail__meta-time" {% if last_used %}title="{{ last_used }}"{% endif %}>
        {{ last_used|humanize if last_used else "unknown" }}
      </span>
    </div>
  </div>
  <div class="tag-detail__summary"
       hx-get="{{ url_for('tags.tag_detail_summary', tag_hash=tag.hash) }}?num_words=28"
       hx-trigger="tag-detail:summary"
       hx-target="this"
       data-tag-hash="{{ tag.hash }}"
       hx-disinherit="hx-target"
       hx-swap="innerHTML swap:120ms">
    <div class="tag-detail-skeleton" aria-hidden="true">
      <span class="tag-detail-skeleton__line"></span>
      <span class="tag-detail-skeleton__line"></span>
    </div>
  </div>
  <div class="tag-detail__entries">
    {% if entries %}
      {% include 'partials/tag_detail_entries_chunk.html' %}
    {% else %}
      <p class="tag-detail__empty">No entries yet.</p>
    {% endif %}
  </div>
</div>
