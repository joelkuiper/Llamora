{% from 'partials/response_kind.html' import response_kind_icon, response_kind_label %}
{% macro entry_response_stream(entry_id, day, user_time=None, sse_url=None, stop_url=None, response_kind=None, response_kinds=()) -%}
{# Quart's url_for drops params set to None, so we can always include user_time #}
{%- if sse_url is none -%}
{%- set sse_url = url_for('entries.sse_response', date=day, entry_id=entry_id, user_time=user_time, response_kind=response_kind) -%}
{%- endif -%}
<response-stream id="response-stream-{{ entry_id }}"
            class="entry response-stream"
            data-entry-id="{{ entry_id }}"
            {%- if response_kind %}
            data-response-kind="{{ response_kind }}"
            {%- endif %}
            data-assistant-entry-id=""
            data-sse-url="{{ sse_url }}"
            {%- if stop_url %}
            data-stop-url="{{ stop_url }}"
            {%- endif %}
            role="article"
            aria-labelledby="entry-{{ entry_id }}-speaker entry-{{ entry_id }}-body">
  <span class="raw-response" hidden></span>

  <span class="visually-hidden" id="entry-{{ entry_id }}-speaker">{{ config.APP_NAME }} response</span>
  <div class="markdown-body" id="entry-{{ entry_id }}-body">
    <span id="typing-indicator-{{ entry_id }}"
          class="typing-indicator"
          data-typing-indicator
          data-entry-id="{{ entry_id }}"
          {%- if stop_url %}
          data-stop-url="{{ stop_url }}"
          {%- endif %}>
      <span class="cursor">âš</span>
    </span>
  </div>

  <div class="entry-actions-inline" aria-label="Assistant entry actions">
    {% if response_kind %}
    {% set response_label = response_kind_label(response_kind, response_kinds) %}
    <span class="entry-action entry-kind-indicator"
          role="img"
          aria-label="{{ response_label }}"
          data-tooltip-title="{{ response_label }}">
      {{ response_kind_icon(response_kind, "entry-kind-icon") }}
      <span class="visually-hidden">{{ response_label }}</span>
    </span>
    {% endif %}
    <button class="entry-action entry-delete"
            type="button"
            disabled
            hx-confirm="Delete this entry?"
            data-confirm-title="Delete entry?"
            data-confirm-message="This entry will be removed from your diary."
            data-confirm-confirm="Delete"
            data-confirm-cancel="Keep"
            data-confirm-variant="danger"
            aria-label="Delete entry"
            data-tooltip-title="Delete entry"
            data-ready="false"
            hx-swap="none"
            data-delete-template="{{ url_for('entries.delete_entry', entry_id='__ENTRY_ID__') }}"
            data-delete-placeholder="__ENTRY_ID__"
            data-target-template="#entry-__ENTRY_ID__">
      <span class="icon-mask icon-trash entry-action__icon" aria-hidden="true"></span>
    </button>
  </div>
</response-stream>
{%- endmacro %}
