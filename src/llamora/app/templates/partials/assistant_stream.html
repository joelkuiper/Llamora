{% macro assistant_stream(user_msg_id, day, user_time=None, sse_url=None, stop_url=None, reply_kind=None) -%}
{# Quart's url_for drops params set to None, so we can always include user_time #}
{%- if sse_url is none -%}
{%- set sse_url = url_for('chat.sse_reply', date=day, user_msg_id=user_msg_id, user_time=user_time, reply_kind=reply_kind) -%}
{%- endif -%}
<llm-stream id="assistant-stream-{{ user_msg_id }}"
            class="message assistant-stream"
            data-user-msg-id="{{ user_msg_id }}"
            {%- if reply_kind %}
            data-reply-kind="{{ reply_kind }}"
            {%- endif %}
            data-assistant-msg-id=""
            data-message-id=""
            data-sse-url="{{ sse_url }}"
            {%- if stop_url %}
            data-stop-url="{{ stop_url }}"
            {%- endif %}
            role="article"
            aria-labelledby="msg-{{ user_msg_id }}-speaker msg-{{ user_msg_id }}-body">
  <span class="raw-response" hidden></span>

  <span class="visually-hidden" id="msg-{{ user_msg_id }}-speaker">{{ config.APP_NAME }} response</span>
  <div class="markdown-body" id="msg-{{ user_msg_id }}-body">
    <span id="typing-indicator-{{ user_msg_id }}"
          class="typing-indicator"
          data-typing-indicator
          data-user-msg-id="{{ user_msg_id }}"
          {%- if stop_url %}
          data-stop-url="{{ stop_url }}"
          {%- endif %}>
      <span class="cursor">âš</span>
    </span>
  </div>

  <button class="message-action message-delete"
          type="button"
          disabled
          aria-label="Delete message"
          title="Delete message"
          data-ready="false"
          hx-swap="outerHTML swap:180ms"
          data-delete-template="{{ url_for('chat.delete_message', msg_id='__MSG_ID__') }}"
          data-delete-placeholder="__MSG_ID__"
          data-target-template="#msg-__MSG_ID__">
    <svg class="message-action__icon" aria-hidden="true" viewBox="0 0 24 24">
      <path fill="currentColor" d="M9 3h6l1 2h4v2H4V5h4l1-2zm1 6h2v9h-2V9zm4 0h2v9h-2V9zM7 9h2v9H7V9zm-1 11h12a2 2 0 0 0 2-2V7H4v11a2 2 0 0 0 2 2z"/>
    </svg>
  </button>

</llm-stream>
{%- endmacro %}
