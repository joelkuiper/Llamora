{% macro entry_tag_item(label, tag_hash, entry_id=None) -%}
  {% set canonical_value = display(label) %}
  <span class="entry-tag" data-tag-hash="{{ tag_hash }}" data-tag-name="{{ canonical_value }}">
    <button class="tag-label"
            type="button"
            aria-haspopup="dialog"
            data-tag-hash="{{ tag_hash }}"
            data-tag-name="{{ canonical_value }}">{{ canonical_value }}</button>
    {% if entry_id %}
    <button class="tag-remove"
            aria-label="Remove trace {{ canonical_value }}"
            hx-delete="{{ url_for('tags.remove_tag', entry_id=entry_id, tag_hash=tag_hash) }}"
            hx-target="closest .entry-tag"
            hx-swap="outerHTML swap:0.15s">&times;</button>
    {% endif %}
  </span>
{%- endmacro %}

{% macro render_entry_tags(entry_id, tags=[], hidden=False) -%}
  <entry-tags class="entry-tags"
              data-entry-id="{{ entry_id }}"
              data-add-tag-url="{{ url_for('tags.add_tag', entry_id=entry_id) }}"
              data-suggestions-url="{{ url_for('tags.get_tag_suggestions', entry_id=entry_id) }}"
              data-tag-detail-url="{{ url_for('tags.tag_detail', tag_hash='__TAG_HASH__') }}"
              data-autocomplete-limit="12"
              hx-trigger="restored"
              {% if hidden %}hidden{% endif %}>
    <button
      data-tooltip-title="Add traces"
      type="button"
      class="add-tag-btn"
      aria-label="Add traces">
      <span class="icon-mask icon-tag" aria-hidden="true"></span>
    </button>

    <div class="entry-tags-list" id="entry-tags-{{ entry_id }}">
      {% for tag in tags %}
      {{ entry_tag_item(tag.name, tag.hash, entry_id) }}
      {% endfor %}
    </div>
  </entry-tags>
{%- endmacro %}
