<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="htmx-config" content='{"historyCacheSize": 12}'>
    <title>{{ config.APP_NAME }}{% block title %}{% endblock %}</title>
    <link rel="icon" href="{{ url_for('static', filename='img/favicon.ico') }}" type="image/x-icon">

    {% if config.STATIC_BUNDLES %}
      {% set app_css = config.STATIC_MANIFEST['css'].get('app-shell') %}
      {% set entry_js = config.STATIC_MANIFEST['js'].get('app') %}
    {% endif %}

    {% if not app_css %}
      {% set app_css = 'css/app.css' %}
    {% endif %}

    <link rel="stylesheet" href="{{ url_for('static', filename=app_css) }}">

    {% if entry_js %}
      <script type="module" defer src="{{ url_for('static', filename=entry_js) }}"></script>
    {% else %}
      <script type="module" defer src="{{ url_for('static', filename='js/app-entry.js') }}"></script>
    {% endif %}

    {% block head_extra %}{% endblock %}
  </head>
  <body
    hx-ext="response-targets"
    hx-target-5*="#errors"
    hx-target-4*="#errors"
    hx-on::after-settle="window.appRuntime?.rehydrate(event)"
    data-entry="{% block body_entry %}app-shell{% endblock %}"
    data-csrf-token="{{ csrf_token() }}"
    data-clock-format="{{ config.get('UI', {}).get('clock_format', '24h') }}">

    <script type="application/json" id="tags-catalog-data" data-tags-catalog>
      {{ (tags_catalog_items if tags_catalog_items is defined else []) | tojson }}
    </script>
    <div id="errors" role="alert" aria-live="assertive" aria-atomic="true" hx-swap="beforeend"></div>
    <header id="app-header">
      {% block header %}{% endblock %}
    </header>

    <div class="app-container">
      {% block content %}{% endblock %}
    </div>

    <div id="profile-modal-root"></div>
    {% include "components/shared/confirm_modal.html" %}

    {% block body_scripts %}{% endblock %}
  </body>
</html>
