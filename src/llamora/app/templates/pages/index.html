{% extends 'layouts/base.html' %}

{% block header %}
  <div class="header-shell page-grid">
    <div class="header-content">
      <div id="branding">
    <a class="branding-link"
       href="{{ url_for('days.day_today') }}"
       aria-label="Return to today"
       data-tooltip-title="Return to today"
       data-tooltip-offset-y="0"
       hx-get="{{ url_for('days.day_today') }}"
       hx-target="#main-content"
       hx-swap="outerHTML"
       hx-push-url="true"
       data-logo-toggle>
          <img class="logo"
               src="{{ url_for('static', filename='img/logo.svg') }}"
               alt="{{ config.APP_NAME }} logo"
               data-light-default="{{ url_for('static', filename='img/logo.svg') }}"
               data-light-hover="{{ url_for('static', filename='img/logo-hover.svg') }}"
               data-light-active="{{ url_for('static', filename='img/logo-hover.svg') }}"
               data-dark-default="{{ url_for('static', filename='img/logo-dark.svg') }}"
               data-dark-hover="{{ url_for('static', filename='img/logo-dark-hover.svg') }}"
               data-dark-active="{{ url_for('static', filename='img/logo-dark-hover.svg') }}">
          <img class="logo-mark"
               src="{{ url_for('static', filename='img/logo-mark.svg') }}"
               alt=""
               aria-hidden="true"
               data-light-default="{{ url_for('static', filename='img/logo-mark.svg') }}"
               data-light-hover="{{ url_for('static', filename='img/logo-mark-hover.svg') }}"
               data-light-active="{{ url_for('static', filename='img/logo-mark-hover.svg') }}"
               data-dark-default="{{ url_for('static', filename='img/logo-mark-dark.svg') }}"
               data-dark-hover="{{ url_for('static', filename='img/logo-mark-dark-hover.svg') }}"
               data-dark-active="{{ url_for('static', filename='img/logo-mark-dark-hover.svg') }}">
        </a>
        <button id="view-mode-toggle"
                type="button"
                class="icon-btn view-mode-toggle view-mode-{{ view|default('diary') }}"
                aria-haspopup="menu"
                aria-expanded="false"
                data-tooltip-title="Change view">
          <span class="icon-mask icon-eye view-icon-eye" aria-hidden="true"></span>
          <span class="icon-mask icon-book-open view-icon-mode view-icon-diary" aria-hidden="true"></span>
          <span class="icon-mask icon-tags view-icon-mode view-icon-tags" aria-hidden="true"></span>
          <span class="icon-mask icon-chart-column view-icon-mode view-icon-structure" aria-hidden="true"></span>
        </button>
        <div id="view-mode-popover"
             class="view-mode-popover glass-panel"
             role="menu"
             hidden>
          <div class="view-mode-panel">
            <a class="view-mode-option{% if view == 'diary' %} is-active{% endif %}"
               role="menuitem"
               data-view-mode="diary"
               hx-get="{{ url_for('days.day', date=day) }}"
               hx-target="#main-content"
               hx-swap="outerHTML"
               hx-push-url="true">
              <span class="icon-mask icon-book-open" aria-hidden="true"></span>
              <span>Diary</span>
            </a>
            <a class="view-mode-option{% if view == 'tags' %} is-active{% endif %}"
               role="menuitem"
               data-view-mode="tags"
               hx-get="{{ url_for('tags.tags_view_page') }}"
               hx-target="#main-content"
               hx-swap="outerHTML"
               hx-push-url="true">
              <span class="icon-mask icon-tags" aria-hidden="true"></span>
              <span>Traces</span>
            </a>
          </div>
        </div>
      </div>

      <calendar-control id="calendar-control" hx-sync="this:replace">
        <button id="prev-day" type="button" class="icon-btn{% if is_first_day %} is-hidden{% endif %}" aria-label="Previous day"
                {% if is_first_day or view != 'diary' %}aria-hidden="true" disabled aria-disabled="true"{% endif %}
                {% if not is_first_day and view == 'diary' %}data-tooltip-title="Previous day"{% endif %}>
          <span class="icon-mask icon-chevron-left" aria-hidden="true"></span>
        </button>
        <button id="calendar-btn" type="button" class="icon-btn" aria-label="Calendar"
                aria-haspopup="dialog" aria-expanded="false" aria-controls="calendar-popover"
                {% if view != 'diary' %}disabled aria-disabled="true"{% endif %}
                {% if view == 'diary' %}data-tooltip-title="Change day"{% endif %}>
          <span class="icon-mask icon-calendar-days" aria-hidden="true"></span>
          <span id="calendar-label">{{ day|long_date }}</span>
        </button>
        <button id="next-day"
                type="button"
                class="icon-btn"
                aria-label="Next day"
                {% if is_today or view != 'diary' %}disabled aria-disabled="true"{% endif %}
                {% if not is_today and view == 'diary' %}data-tooltip-title="Next day"{% endif %}>
          <span class="icon-mask icon-chevron-right" aria-hidden="true"></span>
        </button>
        <div id="calendar-popover"
             class="calendar-popover"
             role="tooltip"
             hidden
             data-calendar-url="{{ url_for('days.calendar_view') }}"></div>
      </calendar-control>

      <div class="header-right">
        <div class="search-wrap">
          <search-overlay>
            {% include 'components/search/search_form.html' %}
            <section id="search-results">
              {% include 'components/search/search_results.html' %}
            </section>
          </search-overlay>
        </div>
        <div class="user-actions">
          <button type="button"
                  class="icon-btn search-toggle"
                  aria-label="Search"
                  aria-expanded="false"
                  data-tooltip-title="Search"
                  data-action="toggle-search-compact">
            <span class="icon-mask icon-search" aria-hidden="true"></span>
          </button>
          <a id="profile-btn"
             href="{{ url_for('auth.profile') }}"
             hx-get="{{ url_for('auth.profile') }}"
             hx-target="#profile-modal-root"
             hx-swap="innerHTML"
             class="icon-btn"
             aria-label="Profile" data-tooltip-title="Profile">
            <span class="icon-mask icon-user-round" aria-hidden="true"></span>
          </a>
          <form method="post" action="{{ url_for('auth.logout') }}">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <button type="submit" class="icon-btn" aria-label="Logout" data-tooltip-title="Logout">
              <span class="icon-mask icon-log-out" aria-hidden="true"></span>
            </button>
          </form>
        </div>
      </div>
    </div>
  </div>
{% endblock %}

{% block content %}
  <div id="content">
    <div id="entries-loading" class="entries-loading" hidden aria-hidden="true">
      <div class="entries-loading__backdrop" aria-hidden="true"></div>
      <div class="entries-loading__panel" role="status" aria-live="polite">
        <span class="entries-loading__spinner spinner" aria-hidden="true"></span>
        <span class="entries-loading__label">Retrievingâ€¦</span>
      </div>
    </div>
    {% include 'components/shared/main_content.html' %}
  </div>
{% endblock %}
