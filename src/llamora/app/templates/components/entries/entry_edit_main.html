{% macro render_entry_edit_main(e, day) -%}
  <div class="entry-main entry-main--editing"
       data-entry-edit-container="true">
    <form class="entry-edit-form"
          hx-put="{{ url_for('entries.update_entry', entry_id=e['id']) }}"
          hx-target="closest .entry-main"
          hx-swap="outerHTML transition:true"
          hx-on::before-request="if(event.detail.elt!==this){return;}this.classList.add('is-saving'); const b=this.querySelector('.entry-edit-save'); if(b){b.classList.add('is-saving'); b.setAttribute('aria-busy','true');} const t=this.querySelector('.entry-edit-area'); if(t){t.readOnly=true;}"
          hx-on::after-request="if(event.detail.elt!==this){return;}this.classList.remove('is-saving'); const b=this.querySelector('.entry-edit-save'); if(b){b.classList.remove('is-saving'); b.removeAttribute('aria-busy');} const t=this.querySelector('.entry-edit-area'); if(t){t.readOnly=false;}"
          data-entry-edit-form="true">
      <textarea class="entry-edit-area"
                id="entry-edit-{{ e['id'] }}-text"
                name="text"
                rows="1"
                spellcheck="true"
                maxlength="{{ config.MAX_MESSAGE_LENGTH }}"
                autofocus>{{- e.get('text', '') | e -}}</textarea>
      <div class="entry-edit-strip">
        <button type="submit"
                class="entry-edit-save"
                aria-label="Save entry">
          <span aria-hidden="true">✓</span>
          <span class="entry-edit-label entry-edit-label--save">Save</span>
          <span class="entry-edit-label entry-edit-label--saving" aria-live="polite">Saving</span>
          <span class="entry-edit-dots" aria-hidden="true">
            <span class="entry-edit-dot"></span>
            <span class="entry-edit-dot"></span>
            <span class="entry-edit-dot"></span>
          </span>
        </button>
        <button type="button"
                class="entry-edit-cancel"
                aria-label="Cancel editing"
                hx-get="{{ url_for('entries.entry_main', entry_id=e['id']) }}"
                hx-target="closest .entry-main"
                hx-swap="outerHTML transition:true">
          <span aria-hidden="true">×</span>
          <span class="entry-edit-label">Cancel</span>
        </button>
        <span class="entry-char-counter"
              data-char-counter
              data-char-counter-for="entry-edit-{{ e['id'] }}-text"
              data-char-threshold="40"
              aria-live="polite"
              aria-atomic="true"></span>
      </div>
    </form>
  </div>
{%- endmacro %}
