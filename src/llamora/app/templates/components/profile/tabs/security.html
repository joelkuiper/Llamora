{% from 'components/shared/password_field.html' import password_field with context %}
{% from 'components/errors/error.html' import alert %}
<div class="profile-section">
  <h3>Change Password</h3>
  {% if pw_error %}
    {{ alert(pw_error) }}
  {% elif pw_success %}
    {{ alert('Password updated', tone='success') }}
  {% endif %}
  <form method="post" action="{{ url_for('auth.change_password') }}"
        hx-post="{{ url_for('auth.change_password') }}"
        hx-target="#profile-modal-content"
        hx-swap="innerHTML">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
    <input class="input" type="password" name="current_password" placeholder="Current password" required maxlength="{{ config.MAX_PASSWORD_LENGTH }}" />
    {{ password_field('new_password', 'New password', 'new-password-strength') }}
    <input class="input" type="password" name="confirm_password" placeholder="Confirm new password" required maxlength="{{ config.MAX_PASSWORD_LENGTH }}" />
    <button class="btn" type="submit" data-loading="Updating">Update Password</button>
  </form>
</div>

<div class="profile-section">
  <h3>Recovery Codes</h3>
  {% if rc_error %}{{ alert(rc_error) }}{% endif %}
  {% if recovery_code %}
    <div class="profile-recovery">
      <p class="profile-note">Save this recovery code somewhere safe.</p>
      <code class="profile-recovery__code">{{ recovery_code }}</code>
    </div>
  {% else %}
    <p class="profile-note">Generate a new recovery code if you lose access.</p>
  {% endif %}
  <form method="post" action="{{ url_for('auth.regen_recovery') }}"
        hx-post="{{ url_for('auth.regen_recovery') }}"
        hx-target="#profile-modal-content"
        hx-swap="innerHTML">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
    <button class="btn" type="submit" data-loading="Generating">Generate New Recovery Code</button>
  </form>
</div>
