{% set heatmap_tag_hash = tag_hash if tag_hash is defined else (tags_view.detail.hash if tags_view is defined and tags_view and tags_view.detail else detail.hash if detail is defined else '') %}
{% set heatmap_offset = heatmap_offset|default(0) %}
{% set heatmap_loaded = activity_heatmap is defined and activity_heatmap %}
{% set safe_has_next = activity_heatmap.has_next if heatmap_loaded else false %}
<div class="tags-view__heatmap"
     hx-get="{{ url_for('tags.tags_view_heatmap', date=day) }}?tag_hash={{ heatmap_tag_hash }}&heatmap_offset={{ heatmap_offset }}"
     hx-trigger="{% if not heatmap_loaded %}load, {% endif %}entries:changed from:body"
     hx-sync="closest .tags-view__heatmap:replace"
     hx-swap="outerHTML"
     data-heatmap-tag="{{ heatmap_tag_hash }}"
     data-heatmap-offset="{{ heatmap_offset }}">
  <div class="tags-view__heatmap-header">
    <div class="tags-view__heatmap-controls" role="group" aria-label="Heatmap paging">
      <button type="button"
              class="tags-view__heatmap-btn"
              aria-label="Previous months"
              {% if not heatmap_loaded %}disabled{% endif %}
              hx-get="{{ url_for('tags.tags_view_heatmap', date=day) }}?tag_hash={{ heatmap_tag_hash }}&heatmap_offset={{ heatmap_offset + 1 }}"
              hx-target="closest .tags-view__heatmap"
              hx-swap="outerHTML swap:160ms settle:160ms">
        <span class="icon-mask icon-circle-arrow-left" aria-hidden="true"></span>
      </button>
      <button type="button"
              class="tags-view__heatmap-btn"
              aria-label="Next months"
              {% if not heatmap_loaded or not safe_has_next %}disabled aria-disabled="true"{% endif %}
              hx-get="{{ url_for('tags.tags_view_heatmap', date=day) }}?tag_hash={{ heatmap_tag_hash }}&heatmap_offset={{ heatmap_offset - 1 if heatmap_offset > 0 else 0 }}"
              hx-target="closest .tags-view__heatmap"
              hx-swap="outerHTML swap:160ms settle:160ms">
        <span class="icon-mask icon-circle-arrow-right" aria-hidden="true"></span>
      </button>
    </div>
  </div>
  <div class="tags-view__heatmap-body">
    {% if heatmap_loaded %}
      {% include 'components/shared/activity_heatmap.html' %}
    {% endif %}
  </div>
</div>
