@layer tokens.motion, motion.keyframes, motion.utilities;

@layer tokens.motion {
  :root {
    --motion-highlight-duration: var(--motion-blink, 1s);
    --motion-highlight-animation: motion-highlight-flash var(
      --motion-highlight-duration
    ) ease-in-out;

    --motion-tag-enter-duration: var(--motion-gentle);
    --motion-tag-exit-duration: var(--motion-hover);
    --motion-tag-enter-animation: motion-tag-enter var(
      --motion-tag-enter-duration
    ) ease both;
    --motion-tag-exit-animation: motion-tag-exit var(--motion-tag-exit-duration)
      ease forwards;

    --motion-tactile-animation: motion-tactile-pulse var(--motion-pulse) ease;

    --motion-entry-delete-duration: var(--motion-gentle);
    --motion-entry-delete-animation: motion-entry-delete var(
      --motion-entry-delete-duration
    ) ease forwards;
  }
}

@layer motion.keyframes {
  @keyframes motion-highlight-flash {
    from {
      background-color: var(--highlight-color);
    }
    to {
      background-color: transparent;
    }
  }

  @keyframes motion-tag-enter {
    from {
      opacity: 0;
    }
    to {
      opacity: 1;
    }
  }

  @keyframes motion-tag-exit {
    from {
      opacity: 1;
      transform: scale(1);
    }
    to {
      opacity: 0;
      transform: scale(0.8);
    }
  }

  @keyframes motion-tactile-pulse {
    0% {
      transform: scale(1);
      background: var(--pulse-bg-start);
    }
    40% {
      transform: scale(0.88);
      background: var(--pulse-bg-mid);
    }
    100% {
      transform: scale(1);
      background: var(--pulse-bg-end);
    }
  }

  @keyframes motion-entry-delete {
    0% {
      opacity: 1;
      transform: translateY(0) scale(1);
    }
    100% {
      opacity: 0;
      transform: translateY(10px) scale(0.98);
    }
  }
}

@layer motion.utilities {
  :where(.highlight) {
    background-color: var(--highlight-color);
  }

  :where(.motion-animate-highlight) {
    animation: var(--motion-highlight-animation) !important;
  }

  :where(.entry-tags).motion-animate-tag-enter,
  :where(.entry-tags).htmx-added,
  :where(.entry-tag).motion-animate-tag-enter,
  :where(.entry-tag).htmx-added {
    animation: var(--motion-tag-enter-animation);
  }

  :where(.entry-tag).motion-animate-tag-exit,
  :where(.entry-tag).htmx-swapping {
    animation: var(--motion-tag-exit-animation);
  }

  :where(.scroll-btn).motion-animate-tactile {
    animation: var(--motion-tactile-animation);
  }

  :where(.motion-animate-entry-delete),
  :where(.entry.htmx-swapping) {
    animation: var(--motion-entry-delete-animation);
  }
}

@layer motion.utilities {
  @media (prefers-reduced-motion: reduce) {
    :where(.motion-animate-highlight),
    :where(.entry-tags).motion-animate-tag-enter,
    :where(.entry-tags).htmx-added,
    :where(.entry-tag).motion-animate-tag-enter,
    :where(.entry-tag).htmx-added,
    :where(.entry-tag).motion-animate-tag-exit,
    :where(.entry-tag).htmx-swapping,
    :where(.scroll-btn).motion-animate-tactile,
    :where(.motion-animate-entry-delete),
    :where(.entry.htmx-swapping) {
      animation: none !important;
    }

    :where(.entry-tag).motion-animate-tag-exit,
    :where(.entry-tag).htmx-swapping {
      opacity: 0;
    }

    :where(.entry-tag).motion-animate-tag-enter,
    :where(.entry-tag).htmx-added,
    :where(.entry-tags).motion-animate-tag-enter,
    :where(.entry-tags).htmx-added {
      opacity: 1;
    }

    :where(.motion-animate-entry-delete),
    :where(.entry.htmx-swapping) {
      opacity: 0;
    }
  }
}
