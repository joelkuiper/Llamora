{% from 'partials/meta_chips.html' import render_meta_chips %}
{% macro assistant_stream(user_msg_id, session_id) -%}
<div id="msg-{{ user_msg_id }}" class="message assistant-stream"
     data-user-msg-id="{{ user_msg_id }}"
     data-assistant-msg-id=""
     hx-ext="sse" sse-close="done"
     sse-connect="{{ url_for('chat.sse_reply', session_id=session_id, user_msg_id=user_msg_id) }}">
  {# data-assistant-msg-id will be set by client JS once streaming completes #}
  <span class="raw-response" sse-swap="message" hidden hx-swap="beforeend"></span>

  <span class="markdown-body">
    <span id="typing-indicator"
          data-user-msg-id="{{ user_msg_id }}"
          data-stop-url="{{ url_for('chat.stop_generation', user_msg_id=user_msg_id) }}"
          sse-swap="done"
          hx-swap="none">
      <span class="cursor">❚</span>
    </span>
  </span>
  {{ render_meta_chips(user_msg_id, hidden=True) }}
  {# meta-chips data-msg-id starts with user_msg_id and will update to assistant_msg_id #}
</div>
{%- endmacro %}
